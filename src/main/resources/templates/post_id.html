<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:insert="fragments/fragments.html :: header"/>

<body>

<div th:replace="fragments/fragments.html :: navigation"></div>

<div class="container border border-secondary rounded my-3 pb-3 whiteBackground">
    <h1 class="display-4 text-center" th:text="${post.name}">Default name</h1>
    <div id="contenuPost" class="my-2 p-2 border borderCustom rounded">Default content</div>
    <div class="text-right mr-3" th:text="'Posted by ' + ${post.user.username} + ' the ' + ${post.modifiedDate}"></div>
    <div class="mt-3" id="commentaires">
        <h3>Comments</h3>
        <hr>
        <!--        Content injected from javascript            -->
    </div>

    <div class="border borderCustom rounded my-3 p-2">
        <form method="post" th:action="@{/comments}" th:object="${comment}">
            <div class="form-group" id="contentContainer">
                <textarea id="content" th:field="*{content}"></textarea>
            </div>
            <input type="hidden" id="post" th:field="*{post}">
            <input type="hidden" id="user" th:field="*{user}">
            <input type="hidden" id="createdDate" th:field="*{createdDate}">
            <div class="text-right">
                <button type="submit" class="btn btn-primary">Comment</button>
            </div>
        </form>
    </div>
</div>

<div th:replace="fragments/fragments.html :: scripts"></div>
<div th:replace="fragments/fragments.html :: scripts_viewer"></div>
<div th:replace="fragments/fragments.html :: scripts_mde"></div>

<script th:inline="javascript">
    /*<![CDATA[*/
    document.getElementById('contenuPost').innerHTML = marked(/*[[${post.content}]]*/);
    const comments = /*[[${post.comments}]]*/
    const users = /*[[${customUsers}]]*/
    for (const commentId in comments) {
        $('#commentaires').append(`<div class="border borderCustom rounded p-2 my-2"><div>${marked(comments[commentId].content)}</div>
            <div class="text-right mr-3"><small>Answered by ${users[commentId]} the ${comments[commentId].createdDate}</small></div></div>`)
        //Source : https://stackoverflow.com/questions/867916/creating-a-div-element-in-jquery
    }
    /*]]>*/
</script>
</body>
</html>