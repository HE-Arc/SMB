<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:insert="fragments/fragments.html :: header"/>

<body>

<div th:replace="fragments/fragments.html :: navigation"></div>

<div class="container border border-secondary rounded my-3 pb-3">
    <h1 class="display-4 text-center" th:text="${post.nom}">Nom par défaut</h1>
    <div id="contenuPost" class="whiteBackground my-2 p-2 border borderCustom rounded">Contenu par défaut</div>
    <div class="text-right mr-3" th:text="'Posted by ' + ${post.user.username}"></div>
    <div class="mt-3" id="commentaires">
        <h3>Commentaires</h3>
        <hr>
        <!--        <div class="border borderCustom rounded" id="commentaire1" th:text="${post.comments}">Commentaire par défaut</div>-->
    </div>

    <div class="border borderCustom rounded my-3 p-2">
        <form method="post" th:action="@{/comments}" th:object="${comment}">
            <div class="form-group">
                <textarea id="contenu" th:field="*{contenu}"></textarea>
            </div>
            <input type="hidden" id="post" th:field="*{post}">
            <input type="hidden" id="user" th:field="*{user}">
            <div class="text-right">
                <button type="submit" class="btn btn-primary">Commenter</button>
            </div>
        </form>
    </div>
</div>

<div th:replace="fragments/fragments.html :: scripts"></div>
<div th:replace="fragments/fragments.html :: scripts_viewer"></div>
<div th:replace="fragments/fragments.html :: scripts_mde"></div>

<script th:inline="javascript">
    /*<![CDATA[*/
    document.getElementById('contenuPost').innerHTML = marked(/*[[${post.contenu}]]*/);
    const comments = /*[[${post.comments}]]*/
    const users = /*[[${customUsers}]]*/
    for (const commentId in comments) {
        $('#commentaires').append(`<div class="border borderCustom rounded p-2 my-2"><div>${marked(comments[commentId].contenu)}</div>
            <div class="text-right mr-3"><small>${users[commentId]}</small></div></div>`)
        //Source : https://stackoverflow.com/questions/867916/creating-a-div-element-in-jquery
    }
    /*]]>*/
</script>
</body>
</html>